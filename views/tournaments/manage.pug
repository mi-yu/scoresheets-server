extends ../layouts/basic

block content
	#content: .ui.container
		h1.ui.header= tournament.name
			.sub.header= tournament.date.toLocaleDateString('en-US')
			.sub.header= tournament.city + ', ' + tournament.state
			.sub.header= tournament.scoresheet
		//- p Proctor registration code:
		//- pre: code.code= tournament.joinCode
		button.ui.button.primary.opens-modal(data-target='#tournament-modal')
			i.icon.edit
			| Edit Details
		.ui.divider
		.ui.accordion
			h3.ui.title.active
				.dropdown.icon
				| Teams
			.content.active
				button.ui.button.primary.opens-modal(data-target='#team-modal')
					i.plus.icon
					| New Team
				.spacer
				if (teams)
						.ui.grid
							each team in teams
								.four.wide.column: .ui.card
									.content
										.header= team.teamNumber
										.meta
											span= team.school
									.extra.content
										a.fluid.ui.button(href='#') 
											i.icon.trophy
											| Scores
		.ui.divider
		.ui.accordion
			h3.ui.title
				.dropdown.icon
				| Events
			.content
				p Add or remove events from the 'Edit Details' button.
				if (tournament.events)
					.ui.grid
						each event in tournament.events
							.four.wide.column: .ui.card
								.content
									.header= event.name
									.description
										if (event.building)
											.ui.tiny.brown.label Building
										if (event.impound)
											.ui.tiny.orange.label Impound
										if (!event.done)
											.ui.tiny.grey.label Scoring in progress
								.extra.content
									a.fluid.ui.button(href='/scoresheets/' + tournament._id + '/scores/' + event._id)
										i.icon.trophy
										| Input/Manage Scores
		.ui.divider
		a.ui.button.red(href='/tournaments/delete/' + tournament._id) Delete Tournament
	include partials/_tournament-modal
	include partials/_team-modal

block scripts
	script.
		// Expose tournament data from back-end
		const tournament = !{JSON.stringify(tournament)}

		// Initialize dropdowns and accordions
		$('.ui.dropdown').dropdown()
		$('.ui.accordion').accordion()

		// Pre-fill events field in tournament form
		tournament.events.forEach((event => {
			$('#events').dropdown('set selected', event.name)
		}))
		let date = new Date(tournament.date)
		$('#date').val(date.toISOString().substr(0, 10))
		$('#states').dropdown('set selected', tournament.state)

		// Bind button to show modal action
		$('.opens-modal').click( function() {
			$($(this).data('target')).modal('show')
		})

		// Bind add all event button
		$('#add-all-events').click(() => {
			$('#events option').each( function() {
				$('#events').dropdown('set selected', $(this).prop('value'))
			})
		})

		// Bind clear all events button
		$('#clear-events').click(() => {
			$('#events option').each( function() {
				$('#events').dropdown('clear')
			})
		})

		// Add custom options to schools dropdown
		const $schoolDropdown = $('#school')
		$('#add-school-button').click(() => {
			const newSchool = $('#add-school-input').val()
			$schoolDropdown.append('<option value="' + newSchool + '" selected>' + newSchool + '</option>')
			$('#school ~ .menu').append('<div class="item" data-value="' + newSchool + '">' + newSchool + '</div>')
		})