extends ../layouts/basic

block content
    #content: .ui.container
        pre= JSON.stringify(teams)
        a.ui.primary.button(href='/tournaments/' + scoresheetEntry.tournament._id + '/manage')
            i.angle.left.icon
            | Back to Tournament
        h1.ui.header= scoresheetEntry.event.name
            .sub.header= scoresheetEntry.tournament.name
        .spacer
        //- a.ui.primary.button(href='/scoresheets/' + scoresheetEntry._id + '/rank')
        //- 	i.trophy.icon
        //- 	| Generate Ranks
        .spacer
        form#scores.ui.form(action='/scoresheets/' + scoresheetEntry._id + '/updateEvent/' + scoresheetEntry.event.name method='post'): table.ui.celled.compact.table
            thead
                tr
                    th.two.wide Team (School)
                    th.two.wide Raw Score
                    th.two.wide Tiebreaker
                        .right.floated.ui.mini.circular.icon.button(data-html='<strong>All ties must be broken</strong>, but how they are broken is up to you. For each set of teams that need ties broken, input larger numbers into this field for teams that win tiebreakers, and leave field as zero otherwise.')
                            i.ui.icon.help
                    th.two.wide Tier 
                        .right.floated.ui.mini.circular.icon.button(data-html='Competitors may be tiered according to event-specific rules. <strong>Please make sure these are accurate</strong> as all tier 2 teams will be ranked below tier 1 teams <strong>regardless of raw score</strong>, all tier 3 below tier 2, and so on.')
                            i.ui.icon.help
                    th No Show
                        .right.floated.ui.mini.circular.icon.button(data-html='<strong>No shows are ranked last place + 1</strong>, so if there are 30 teams this team will be ranked 31st. This greatly affects a school\'s overall placement, so please be <strong>certain</strong> that this team did not show up before checking the box.')
                            i.ui.icon.help
                    th Participation
                        .right.floated.ui.mini.circular.icon.button(data-html='Teams may be awarded participation points if an honest attempt was made but a <strong>raw score was unable to be assigned</strong>. <strong>They will be ranked last place</strong>.')
                            i.ui.icon.help
                    th Dropped
                        .right.floated.ui.mini.circular.icon.button(data-html='A team may be allowed to drop an event. <strong>They will receive a score of 0 for this event</strong>, so please be sure this is accurate.')
                            i.ui.icon.help
                    th Disqualified
                        .right.floated.ui.mini.circular.icon.button(data-html='A team may be disqualified for cheating or other serious offenses. Coaches must be contacted as soon as possible after issuing a DQ. This team will be assigned a rank of total teams + 2.')
                            i.ui.icon.help
                    th Notes
                        .right.floated.ui.mini.circular.icon.button(data-html='Here you can take optional notes to help you remember how ties were broken, what caused a team to be disqualified, and anything else that is not otherwise represented in the other fields.')
                            i.ui.icon.help
                    th Rank
                        .right.floated.ui.mini.circular.icon.button(data-html='These are automatically generated and cannot be edited.')
                            i.ui.icon.help
            tbody
                each score in scoresheetEntry.scores
                    tr
                        td= score.team.division + score.team.teamNumber + ' (' + score.team.school + ')'
                        td
                            .field
                                input(type='number' name=score._id + '[rawScore]' value=score.rawScore || 0)
                        td
                            .field
                                input(type='number' name=score._id + '[tiebreaker]' value=score.tiebreaker || 0)
                        td
                            .field
                                select.ui.compact.dropdown(name=score._id + '[tier]')
                                    each i in [1,2,3,4]
                                        option(value = i selected = score.tier === i ? true : false)= i
                        td.center.aligned
                            .inline.fields
                                .ui.checkbox
                                    input(type='checkbox' name=score._id + '[noShow]' checked=score.noShow)
                                    label NS?
                        td
                            .inline.fields
                                .ui.checkbox
                                    input(type='checkbox' name=score._id + '[participationOnly]' checked=score.participationOnly)
                                    label PP?
                        td
                            .inline.fields
                                .ui.checkbox
                                    input(type='checkbox' name=score._id + '[dropped]' checked=score.dropped)
                                    label Dropped?
                        td
                            .inline.fields
                                .ui.checkbox
                                    input(type='checkbox' name=score._id + '[dq]' checked=score.dq)
                                    label DQ?
                        td
                            .field
                                textarea(name=score._id + '[notes]' rows=3)= score.notes || ''
                        td.red.center.aligned= score.rank || 0
        .spacer
        button.ui.primary.button(type='submit' form='scores') Save

block scripts
    script.
        const scoresheetEntry = !{JSON.stringify(scoresheetEntry)}

        $('.ui.dropdown').dropdown()
        $('.ui.mini.circular.icon.button').popup()


